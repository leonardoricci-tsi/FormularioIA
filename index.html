<!doctype html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pesquisa: IA e Processos Cognitivos (An√¥nima)</title>
  <meta name="description"
    content="Formul√°rio an√¥nimo sobre impactos da IA nos processos cognitivos de jovens acad√™micos." />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <main class="container">
    <div class="card">
      <header class="form-head">
        <div class="badge" aria-hidden="true">Formul√°rio An√¥nimo</div>
        <h1>Pesquisa ‚Äî IA & Processos Cognitivos</h1>
        <p class="lead">Question√°rio <strong>an√¥nimo</strong> para avaliar efeitos do uso de IA na aprendizagem,
          mem√≥ria, aten√ß√£o e tomada de decis√£o de jovens acad√™micos. N√£o coletamos nome, e‚Äëmail ou identificadores
          pessoais.</p>
      </header>

      <form id="survey" autocomplete="off" aria-describedby="privacy-note">
        <ol class="form-steps" aria-hidden="true">
          <li data-step="1">Perfil b√°sico</li>
          <li data-step="2">Uso de IA</li>
          <li data-step="3">Impactos percebidos</li>
          <li data-step="4">Riscos e estrat√©gias</li>
        </ol>
        <!-- Aviso de anonimato e consentimento -->
        <section class="consent" role="region" aria-label="Consentimento e anonimato">
          <p id="privacy-note" class="hint">üîí As respostas s√£o coletadas de forma confidencial e n√£o permitem a
            identifica√ß√£o dos participantes.
            Por favor, n√£o insira nome, e-mail, RA ou qualquer informa√ß√£o pessoal que possa associar sua identidade √†s
            respostas.
            O objetivo √© garantir sigilo e imparcialidade total na coleta dos dados.</p>
          <label class="chip chip-inline" for="consent">
            <input id="consent" name="consent" type="checkbox" required>
            <span class="chip-label">Li e concordo em participar voluntariamente desta pesquisa.<span class="required"
                aria-hidden="true">*</span></span>
          </label>
        </section>

        <!-- Perfil m√≠nimo (an√¥nimo): faixas et√°rias e curso opcional -->
        <fieldset aria-describedby="demographic-note">
          <legend>Perfil Demogr√°fico (opcional)</legend>
          <p id="demographic-note" class="legend-sub">Compartilhe apenas se desejar; os dados s√£o analisados de forma
            agregada e sem identifica√ß√£o individual.</p>
          <div class="grid grid-2">
            <div class="input-group">
              <label for="ageRange">Faixa et√°ria atual</label>
              <div class="select-wrapper">
                <select id="ageRange" name="ageRange">
                  <option value="">Prefiro n√£o informar</option>
                  <option>18‚Äì19</option>
                  <option>20‚Äì21</option>
                  <option>22‚Äì23</option>
                  <option>24‚Äì25</option>
                  <option>26+</option>
                </select>
              </div>
              <p class="hint">Manter uma faixa et√°ria ampla evita identifica√ß√£o direta e sustenta a an√°lise estat√≠stica.
              </p>
            </div>
            <div class="input-group">
              <label for="semester">Per√≠odo/semestre atual (opcional)</label>
              <div class="select-wrapper">
                <select id="semester" name="semester">
                  <option value="">Prefiro n√£o informar</option>
                  <option>1¬∫</option>
                  <option>2¬∫</option>
                  <option>3¬∫</option>
                  <option>4¬∫</option>
                  <option>5¬∫+</option>
                </select>
              </div>
            </div>
          </div>
        </fieldset>

        <!-- Frequ√™ncia e contexto de uso -->
        <fieldset aria-describedby="usage-note">
          <legend>Uso de IA</legend>
          <p id="usage-note" class="legend-sub">Dimens√µes que caracterizam a intensidade e os cen√°rios de uso da IA na
            vida acad√™mica e pessoal.</p>
          <div class="grid grid-2">
            <div class="input-group">
              <label for="freq">Frequ√™ncia de uso de IA em atividades acad√™micas<span class="required"
                  aria-hidden="true">*</span></label>
              <div class="select-wrapper">
                <select id="freq" name="freq" required>
                  <option value="">Selecione uma op√ß√£o‚Ä¶</option>
                  <option>Nunca</option>
                  <option>Raramente (menos de 1x/semana)</option>
                  <option>Algumas vezes por semana</option>
                  <option>Diariamente</option>
                  <option>V√°rias vezes ao dia</option>
                </select>
              </div>
            </div>
            <div class="input-group">
              <label>Em quais contextos voc√™ utiliza IA? (marque quantos forem pertinentes)</label>
              <div class="options">
                <label class="chip">
                  <input type="checkbox" name="context" value="Estudos">
                  <span class="chip-label">Estudos/pesquisa acad√™mica</span>
                </label>
                <label class="chip">
                  <input type="checkbox" name="context" value="Profissional">
                  <span class="chip-label">Tarefas pessoais/profissionais</span>
                </label>
                <label class="chip">
                  <input type="checkbox" name="context" value="Lazer">
                  <span class="chip-label">Lazer/entretenimento</span>
                </label>
                <label class="chip">
                  <input type="checkbox" name="context" value="Escrita">
                  <span class="chip-label">Apoio √† escrita/textos</span>
                </label>
                <label class="chip">
                  <input type="checkbox" name="context" value="Outro">
                  <span class="chip-label">Outro</span>
                </label>
              </div>
            </div>
          </div>
        </fieldset>

        <!-- Impactos cognitivos (Likert) -->
        <fieldset aria-describedby="impact-note">
          <legend>Percep√ß√£o de Impactos Cognitivos</legend>
          <p id="impact-note" class="legend-sub">Avalie o quanto voc√™ concorda com cada afirma√ß√£o sobre efeitos
            cognitivos observados ao usar IA.</p>
          <div class="grid">
            <div class="input-group">
              <label for="compr">O uso de IA amplia minha compreens√£o de novos conte√∫dos.</label>
              <div class="select-wrapper">
                <select id="compr" name="compr">
                  <option value="">Selecione uma op√ß√£o‚Ä¶</option>
                  <option>Discordo totalmente</option>
                  <option>Discordo parcialmente</option>
                  <option>Nem concordo nem discordo</option>
                  <option>Concordo parcialmente</option>
                  <option>Concordo totalmente</option>
                </select>
              </div>
            </div>
            <div class="input-group">
              <label for="mem">Percebo melhora na minha reten√ß√£o e mem√≥ria quando utilizo IA como apoio.</label>
              <div class="select-wrapper">
                <select id="mem" name="mem">
                  <option value="">Selecione uma op√ß√£o‚Ä¶</option>
                  <option>Discordo totalmente</option>
                  <option>Discordo parcialmente</option>
                  <option>Nem concordo nem discordo</option>
                  <option>Concordo parcialmente</option>
                  <option>Concordo totalmente</option>
                </select>
              </div>
            </div>
            <div class="input-group">
              <label for="dec">A IA fortalece meu racioc√≠nio e tomada de decis√£o em tarefas acad√™micas.</label>
              <div class="select-wrapper">
                <select id="dec" name="dec">
                  <option value="">Selecione uma op√ß√£o‚Ä¶</option>
                  <option>Discordo totalmente</option>
                  <option>Discordo parcialmente</option>
                  <option>Nem concordo nem discordo</option>
                  <option>Concordo parcialmente</option>
                  <option>Concordo totalmente</option>
                </select>
              </div>
            </div>
            <div class="input-group">
              <label for="auto">A IA contribui para ampliar minha autonomia intelectual.</label>
              <div class="select-wrapper">
                <select id="auto" name="auto">
                  <option value="">Selecione uma op√ß√£o‚Ä¶</option>
                  <option>Discordo totalmente</option>
                  <option>Discordo parcialmente</option>
                  <option>Nem concordo nem discordo</option>
                  <option>Concordo parcialmente</option>
                  <option>Concordo totalmente</option>
                </select>
              </div>
            </div>
          </div>
        </fieldset>

        <!-- Riscos e desafios -->
        <fieldset aria-describedby="risk-note">
          <legend>Riscos e Desafios</legend>
          <p id="risk-note" class="legend-sub">Indique seu grau de concord√¢ncia com poss√≠veis riscos associados ao uso
            cont√≠nuo de IA.</p>
          <div class="grid">
            <div class="input-group">
              <label for="dep">Sinto depend√™ncia de solu√ß√µes de IA para concluir atividades acad√™micas.</label>
              <div class="select-wrapper">
                <select id="dep" name="dep">
                  <option value="">Selecione uma op√ß√£o‚Ä¶</option>
                  <option>Discordo totalmente</option>
                  <option>Discordo parcialmente</option>
                  <option>Nem concordo nem discordo</option>
                  <option>Concordo parcialmente</option>
                  <option>Concordo totalmente</option>
                </select>
              </div>
            </div>
            <div class="input-group">
              <label for="aten">O uso prolongado de IA diminui minha aten√ß√£o e foco.</label>
              <div class="select-wrapper">
                <select id="aten" name="aten">
                  <option value="">Selecione uma op√ß√£o‚Ä¶</option>
                  <option>Discordo totalmente</option>
                  <option>Discordo parcialmente</option>
                  <option>Nem concordo nem discordo</option>
                  <option>Concordo parcialmente</option>
                  <option>Concordo totalmente</option>
                </select>
              </div>
            </div>
            <div class="input-group">
              <label for="risco">Qual √©, na sua avalia√ß√£o, o principal risco associado ao uso excessivo de IA?</label>
              <div class="select-wrapper">
                <select id="risco" name="risco">
                  <option value="">Selecione a alternativa que melhor representa sua percep√ß√£o‚Ä¶</option>
                  <option>Depend√™ncia tecnol√≥gica elevada</option>
                  <option>Redu√ß√£o do pensamento cr√≠tico</option>
                  <option>Menor reten√ß√£o de conte√∫do</option>
                  <option>Desigualdade de acesso √†s ferramentas</option>
                  <option>N√£o identifico riscos relevantes</option>
                  <option>Outro</option>
                </select>
              </div>
            </div>
          </div>
        </fieldset>

        <!-- Estrat√©gias e senso cr√≠tico -->
        <fieldset aria-describedby="strategy-note">
          <legend>Estrat√©gias e Senso Cr√≠tico</legend>
          <p id="strategy-note" class="legend-sub">Identifique estrat√©gias adotadas e a percep√ß√£o geral sobre o papel da
            IA no processo de aprendizagem.</p>
          <div class="grid">
            <div class="input-group">
              <label for="equilibrio">Voc√™ adota estrat√©gias estruturadas para equilibrar IA e estudo aut√¥nomo?</label>
              <div class="select-wrapper">
                <select id="equilibrio" name="equilibrio">
                  <option value="">Selecione uma op√ß√£o‚Ä¶</option>
                  <option>Sim, de forma consistente</option>
                  <option>Sim, em situa√ß√µes espec√≠ficas</option>
                  <option>Estou desenvolvendo estrat√©gias</option>
                  <option>Ainda n√£o adoto estrat√©gias estruturadas</option>
                </select>
              </div>
            </div>
            <div class="input-group">
              <label for="percepcao">Na sua percep√ß√£o geral, a IA representa‚Ä¶</label>
              <div class="select-wrapper">
                <select id="percepcao" name="percepcao">
                  <option value="">Selecione uma op√ß√£o‚Ä¶</option>
                  <option>Principalmente um apoio complementar ao aprendizado</option>
                  <option>Uma ferramenta que substitui parte do esfor√ßo cognitivo</option>
                  <option>Um risco direto √† autonomia cognitiva</option>
                  <option>Outro posicionamento</option>
                </select>
              </div>
            </div>
          </div>
        </fieldset>

        <div class="btns">
          <button type="submit" class="primary">Enviar respostas</button>
          <button type="reset" class="ghost">Limpar</button>
        </div>

        <div id="errorBox" class="error" role="alert">Ocorreu um erro ao enviar. Tente novamente.</div>
        <div id="successBox" class="success" role="status">
          <h2>‚úÖ Resposta registrada!</h2>
          <p>Obrigado por participar. Voc√™ pode fechar esta p√°gina com seguran√ßa.</p>
        </div>
        <p class="footer">Muito Obrigado por fazer parte dessa pesquisa.</p>
      </form>
    </div>
  </main>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

    // ===== Configura√ß√£o do envio =====
    // Op√ß√£o A: Preencha SUPABASE_URL/KEY para gravar direto na tabela "respostas_ia"
    //    create table respostas_ia (
    //      id bigint generated always as identity primary key,
    //      payload jsonb not null,
    //      csv_line text,
    //      created_at timestamp with time zone default timezone('utc', now())
    //    );
    //    Habilite RLS com pol√≠tica de insert via anon quando aplic√°vel.
    // Op√ß√£o B: Use ENDPOINT_URL para encaminhar via requisi√ß√£o POST (Edge Function, webhook, etc.).

    const SUPABASE_URL = "https://pgipqiardziraldqfqsc.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBnaXBxaWFyZHppcmFsZHFmcXNjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIyOTUwMjAsImV4cCI6MjA3Nzg3MTAyMH0.9JcFA7W6Ge2karQTBDDCTcPQnspI4qb2NIFo0agyJ-c";
    const SUPABASE_TABLE = "respostas_ia";
    const ENDPOINT_URL = "";      // exemplo: https://<PROJECT>.functions.supabase.co/coletar-form

    const supabase = (SUPABASE_URL && SUPABASE_ANON_KEY)
      ? createClient(SUPABASE_URL, SUPABASE_ANON_KEY, { auth: { persistSession: false } })
      : null;

    const form = document.getElementById('survey');
    const successBox = document.getElementById('successBox');
    const errorBox = document.getElementById('errorBox');

    const CSV_FIELD_ORDER = [
      'ageRange',
      'semester',
      'freq',
      'context',
      'compr',
      'mem',
      'dec',
      'auto',
      'dep',
      'aten',
      'risco',
      'equilibrio',
      'percepcao'
    ];

    const CSV_HEADERS = [
      'faixa_etaria',
      'semestre',
      'frequencia_uso',
      'contextos_uso',
      'impacto_compreensao',
      'impacto_memoria',
      'impacto_decisao',
      'impacto_autonomia',
      'risco_dependencia',
      'risco_atencao',
      'principal_risco',
      'estrategias_equilibrio',
      'percepcao_geral'
    ];

    function formDataToJson(fd) {
      const data = {};
      // coleta m√∫ltiplos checkboxes com o mesmo nome em array
      for (const [key, value] of fd.entries()) {
        if (key === 'context') {
          if (!data[key]) data[key] = [];
          data[key].push(value);
        } else if (key === 'consent') {
          data[key] = true;
        } else {
          if (typeof value === 'string') {
            const trimmed = value.trim();
            data[key] = trimmed;
          } else {
            data[key] = value;
          }
        }
      }
      return data;
    }

    function toCsvLine(data) {
      const row = CSV_FIELD_ORDER.map((field) => {
        const value = data[field];
        if (Array.isArray(value)) {
          return value.length ? value.join('; ') : '';
        }
        if (value === undefined || value === null) return '';
        return String(value);
      });
      return row.map(escapeCsvValue).join(',');
    }

    function escapeCsvValue(value) {
      if (value === '') return '';
      const needsQuotes = value.includes(',') || value.includes('"') || value.includes('\n');
      const sanitized = value.replace(/"/g, '""');
      return needsQuotes ? `"${sanitized}"` : sanitized;
    }

    function triggerCsvDownload(csvLine) {
      const csvContent = [CSV_HEADERS.join(','), csvLine].join('\n');
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `resposta-ia-${new Date().toISOString().slice(0, 19).replace(/[:T]/g, '-')}.csv`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      errorBox.style.display = 'none';
      successBox.style.display = 'none';

      // Bloqueio simples contra campos identific√°veis
      const forbidden = ['nome', 'email', 'ra'];
      const hasForbidden = forbidden.some((id) => {
        const el = form.querySelector(`[name="${id}"]`);
        return el && el.value && el.value.trim().length > 0;
      });
      if (hasForbidden) {
        errorBox.textContent = 'Por favor, n√£o informe nome, e‚Äëmail ou RA.';
        errorBox.style.display = 'block';
        return;
      }

      const payload = formDataToJson(new FormData(form));
      const csvLine = toCsvLine(payload);

      try {
        if (supabase) {
          const insertPayload = { payload, csv_line: csvLine };
          const { error } = await supabase.from(SUPABASE_TABLE).insert(insertPayload);
          if (error) {
            const detailed = error.details || error.hint || error.message;
            throw new Error(detailed || 'Falha no envio');
          }
        } else if (ENDPOINT_URL) {
          const res = await fetch(ENDPOINT_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ payload })
          });
          if (!res.ok) {
            const text = await res.text();
            throw new Error(text || 'Falha no envio');
          }
        } else {
          // Sem integra√ß√£o configurada: modo offline
          successBox.style.display = 'block';
          triggerCsvDownload(csvLine);
          form.reset();
          return;
        }

        successBox.style.display = 'block';
        form.reset();
      } catch (err) {
        console.error(err);
        errorBox.textContent = err?.message
          ? `Erro no envio: ${err.message}`
          : 'Ocorreu um erro ao enviar. Tente novamente.';
        errorBox.style.display = 'block';
      }
    });
  </script>
</body>

</html>